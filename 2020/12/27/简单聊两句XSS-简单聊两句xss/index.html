
<!DOCTYPE html>
<html lang="zh ">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>贪婪的君子 || 简单聊两句XSS</title>
    <meta name="author" content="z">
    <meta name="description" content="不忘初心，方得始终 ">
    <meta name="keywords" content=" ">
    <link rel="icon" href="/image/profile.webp">
    <link rel="stylesheet" href="/css/antd.min.css">
    
    <link rel="stylesheet" href="/css/full-theme.css">
    
    <script src="/js/vue.js"></script>
    <script src="/js/antd.min.js"></script>
<meta name="generator" content="Hexo 6.3.0"></head>

<body>

    <div id="loading"
        style="height: 100vh; width: 100%; position: fixed;display: flex;z-index: 200; justify-content: space-between;">
        <div id="loadleft" style="width: 50%;background-color: #ffffff;transition: width 0.6s ease-out;"></div>
        <div id="loadright" style="width: 50%;background-color: #ffffff;transition: width 0.6s ease-out;"></div>
        <div
            style="position: fixed; height: 100vh; width: 100%;display: flex;justify-content: center;align-items: center;">
            <div id="loadcontent"
                style="width:400px;height:400px;padding:50px;border-radius:50%;display:flex;justify-content:center;align-items:center;border:solid 10px#a3ddfb; text-align:center;opacity:1;transition:opacity 0.3s ease-out;">
                <div>
                    <h2>LOADING...</h2>
                    <p>加载过慢请开启缓存(浏览器默认开启)</p>
                    <div>
                        <img src="/dancingkitty.gif" alt="loading">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="layout">
        <transition name="into">
            <div v-show="show_page" style="display: none;">
                <div id="menu_show">
                     
<nav id="menu">
    <div class="desktop-menu">
        <a href="/">
            <span class="title">贪婪的君子</span>
        </a>
        
        <a href="/">
            <span>
                <a-icon type="home" theme="filled" />
            </span>
            <span>home</span>
        </a>
        
        <a href="/archives">
            <span>
                <a-icon type="folder" theme="filled" />
            </span>
            <span>archives</span>
        </a>
        
    </div>

    <div :class="'phone-menu ' + menu_show" id="phone-menu">
        <div :class="'title'" @click="menu_show=!menu_show">
            <span style="margin-right: 10px;">
                <a-icon type="appstore" theme="filled" />
            </span>
            <span>贪婪的君子</span>
        </div>
        <div class="items" v-show="menu_show">
            
            <a href="/">
                <div class="item">
                    <div style="min-width:20px; max-width:50px; width: 10%">
                        <a-icon type="home" theme="filled" />
                    </div>
                    <div style="min-width:100px;max-width: 150%;width: 20%;">home</div>
                </div>
            </a>
            
            <a href="/archives">
                <div class="item">
                    <div style="min-width:20px; max-width:50px; width: 10%">
                        <a-icon type="folder" theme="filled" />
                    </div>
                    <div style="min-width:100px;max-width: 150%;width: 20%;">archives</div>
                </div>
            </a>
            
        </div>
        <div class="curtain" v-show="menu_show"></div>
    </div>

</nav>
                </div>

                <div id="main">
                     
<link rel="stylesheet" href="/css/post-body.css">
<div class="article">
    <div>
        <h1>简单聊两句XSS </h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <a-icon type="calendar" theme="filled" />
            </span>
            2020/12/27
        </span>

        
        <span class="category">
            <a href="/categories/前端基础">
                <span class="icon">
                    <a-icon type="book" theme="filled" />
                </span>
                前端基础
            </a>
        </span>
        

        

        <span class="tags">
            <span class="icon">
                <a-icon type="tags" theme="filled" />
            </span>
            
            <span class="tag">
                
                <a href="/tags/安全" style=color:#03a9f4>
                    安全
                </a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/xss" style=color:#ffa2c4>
                    xss
                </a>
            </span>
            
        </span>
        
    </div>

    <div class="content" v-pre>
        <blockquote>
<p>XSS（跨站脚本攻击），聊两句，五毛的。</p>
</blockquote>
<h4 id="XSS的危害："><a href="#XSS的危害：" class="headerlink" title="XSS的危害："></a>XSS的危害：</h4><ul>
<li>窃取Cookie，盗用用户身份信息</li>
</ul>
<p>这玩意儿是大多数XSS的目标，也好解决，可以先治个标，直接设置<code>HttpOnly=true</code> ，即不允许客户端脚本访问，设置完成后，通过js去读取cookie，你会发现<code>document.cookie</code> 无法读取到被标识为HttpOnly的Cookie内容了。</p>
<ul>
<li>配合其他漏洞，如CSRF（跨站请求伪造）</li>
</ul>
<p>这个其实就没那么好解决了，因为XSS利用用户身份构造的请求其实对于服务端来说是合法的。比如说咱在B站上传了一条视频，发现没几个人点赞，于是动了歪心思，打开控制台找到了投币点赞的接口，然后拿到了对应的请求参数。自己构造了一条投币请求，然后诱导其他人点击含有这个脚本的页面为咱的视频投币，这样就完成了一套攻击流程。</p>
<blockquote>
<p>不用尝试了，没用的。别问我怎么知道的 &#x3D;。&#x3D;。</p>
<p>要是没做校验的话，那这就是一个高危漏洞，还传啥视频啊，赶紧发邮件给阿B领赏金去啊。</p>
</blockquote>
<ul>
<li>广告</li>
</ul>
<p>只要能发起XSS，我就能往页面里插广告，啥权限都不要，但是能引发这个问题的原因主要有两个。</p>
<ol>
<li>XSS。</li>
<li>用户自己安装外部脚本。</li>
</ol>
<blockquote>
<p>使用外部脚本一定要保证脚本来源的可信性，脚本的安全性。如果脚本是恶意的，那么他所能做的可就不只是弹弹广告这么简单了，替换个按钮，诱导点击钓鱼页面，替换某一条搜索结果，这都是可能的。</p>
</blockquote>
<h4 id="XSS扫描及防范"><a href="#XSS扫描及防范" class="headerlink" title="XSS扫描及防范"></a>XSS扫描及防范</h4><p>XSS风险有些是可以通过code review发现的，比如：</p>
<pre><code class="js">let result = document.getElementById(&#39;test&#39;);
result.innerHTML = await getInfo();
</code></pre>
<p>这段代码很容易看到风险位置——<code>innerHTML</code> ，如果后端返回的数据中包含恶意的代码片段，那么就能够被攻击。所以在使用Vue和React框架时，需要评估是否真的需要使用<code>v-html</code> 和<code>dangerouslySetInnerHTML</code> 功能，在前端的render（渲染）阶段就避免<code>innerHTML</code> 和 <code>outerHTML</code> <a href="%5B%E5%A6%82%E4%BD%95%E9%98%B2%E6%AD%A2xss%E6%94%BB%E5%87%BB%5D(https://tech.meituan.com/2018/09/27/fe-security.html)">^1</a>。</p>
<blockquote>
<p>如果不使用框架，那就避免直接使用<code>innerHTML</code> 就好了。</p>
</blockquote>
<p>至于review时无法发现的风险，那就交给扫描器吧。</p>
<p>防范XSS，除了少使用、不使用<code>innerHTML</code> 外，还可以设置严格的CSP<a href="%5B%E5%86%85%E5%AE%B9%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5%5D(https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP)">^2</a>，限制用户的输入长度。</p>
<blockquote>
<p>XSS是一个安全问题，它不只是前端的职责，这也是所有RD和QA的职责。</p>
<p>前端过滤用户输入后发给后端，后端如果不做处理存入数据库，那么这就是一个攻击点：直接抓前端的包，重新组装一下参数，发给后端，完成存储型XSS第一步，用户再访问这部分内容，就完成了一次XSS。</p>
<p>QA的总能搞出来一些奇奇怪怪的payload（亦称测试用例），这些可能都是RD未能考虑到的方面。</p>
</blockquote>
<p>附一段白名单过滤用户输入的代码，点击<a target="_blank" rel="noopener" href="https://github.com/ai977313677/blog/blob/master/snippet/xssFilter.js">GitHub</a>查看。</p>

    </div>

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <div id="comment">
        <div id="gitalk-container">
        </div>
    </div>
    
</div>
                     
<footer id="footer">
    <div class="footer-wrap">
        <div>
            © 2018 - 2023 贪婪的君子
            <span class="footer-icon">
                <a-icon type="flag" theme="filled" /></span>
            @z
        </div>
        <div></div>
        <div>Based on the <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo Engine</a> & <a
                target="_blank" rel="noopener" href="https://github.com/korilin/hexo-theme-particle">Particle Theme</a></div>
        
    </div>

</footer>

<script src="/js/highlight.min.js"></script>
<script src="/js/particle.js"></script>
                </div>
            </div>
        </transition>
    </div>

    <script>
    new Vue({
        el: "#layout",
        data: {
            show_page: false,
            onload_menu: false,
            menu_show: false,
            card_top: 100
        },
        created: function () {
            var that = this
            window.onload = function () {
                that.show_page = true
                document.getElementById("loadcontent").style.opacity = 0
                setTimeout(function () {
                    document.getElementById("loadleft").style.width = 0
                    document.getElementById("loadright").style.width = 0
                }, 300)
                setTimeout(function () {
                    document.getElementById("loading").style = "display:none"
                }, 600)
            }
        },
        mounted: function () {
            var that = this
            window.addEventListener('scroll', function (e) {
                that.menu_show = false
            })
        },
        methods: {
            home_click: function () {
                window.scrollTo({
                    top: window.innerHeight - 80,
                    behavior: "smooth",
                });
            }
        }
    })
</script>

<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script>
    const gitalk = new Gitalk({
        clientID: '',
        clientSecret: '',
        repo: 'hexo-theme-particle',      // The repository of store comments,
        owner: 'korilin',
        admin: ['korilin'],
        language: 'en',
        id: location.pathname,      // Ensure uniqueness and length less than 50
        distractionFreeMode: true  // Facebook-like distraction free mode
    })
    gitalk.render('gitalk-container')
</script>

</body>

</html>